<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Mapa de Camiones con Estados y Tooltips</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: sans-serif;
        }

        #map {
            width: 100%;
            height: 100vh;
        }

        .truck-tooltip {
            background: rgba(255, 255, 255, 0.95);
            padding: 4px 8px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: bold;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
            text-align: center;
            white-space: nowrap;
            pointer-events: none; /* para que el tooltip no interfiera con el mouse */
        }
    </style>
</head>
<body>

<div id="map"></div>

<script>
    // Inicializar el mapa
    const map = L.map('map').setView([-22.3, -68.9], 14);

    // Capa base OSM
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '춸 OpenStreetMap contributors'
    }).addTo(map);

    // Datos de camiones de ejemplo
    const camiones = [
        {
            nombre: "Cami칩n A",
            lat: -22.305,
            lng: -68.91,
            estado: "Running",
            timestamp: "2025-07-23 10:45"
        },
        {
            nombre: "Cami칩n B",
            lat: -22.308,
            lng: -68.905,
            estado: "Idle",
            timestamp: "2025-07-23 10:30"
        },
        {
            nombre: "Cami칩n C",
            lat: -22.31,
            lng: -68.89,
            estado: "Inactive",
            timestamp: "2025-07-23 10:15"
        },
        {
            nombre: "Cami칩n D",
            lat: -22.32,
            lng: -68.90,
            estado: "Stopped",
            timestamp: "2025-07-23 10:34"
        }
    ];

    // Crear 칤cono seg칰n estado usando CDN
    const createTruckIcon = (state) => {
        let iconUrl;

        switch(state) {
            case "Idle":
                iconUrl = "https://cdn.jsdelivr.net/gh/adaneson/iconos-camiones/Camion_Amarillo.png";
                break;
            case "Running":
                iconUrl = "https://cdn.jsdelivr.net/gh/adaneson/iconos-camiones/Camion_Verde.png";
                break;
            case "Stopped":
                iconUrl = "https://cdn.jsdelivr.net/gh/adaneson/iconos-camiones/Camion_Salmon.png";
                break;
            default:
                iconUrl = "https://cdn.jsdelivr.net/gh/adaneson/iconos-camiones/Camion_Rojo.png";
                break;
        }

        return L.icon({
            iconUrl: iconUrl,
            iconSize: [80, 80],         // tama침o del 칤cono (ancho x alto)
            iconAnchor: [40, 80],       // punto "punta del 칤cono"
            popupAnchor: [0, -90]       // mueve el popup hacia arriba si usas popup
        });
    };

    // Dibujar camiones en el mapa con tooltip siempre visible
    camiones.forEach(camion => {
        const iconoCamion = createTruckIcon(camion.estado);

        const marker = L.marker([camion.lat, camion.lng], { icon: iconoCamion }).addTo(map);

        marker.bindTooltip(`
            游뚴 ${camion.nombre}<br>
            <small>${camion.timestamp}</small><br>
            <small>Estado: ${camion.estado}</small>
        `, {
            permanent: true,
            direction: 'top',
            offset: [0, -60],
            className: 'truck-tooltip'
        });
    });
</script>

</body>
</html>
